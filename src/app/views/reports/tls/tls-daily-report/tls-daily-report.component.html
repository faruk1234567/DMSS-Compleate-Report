<div class="container-fluid px-3 px-md-4">
  <div class="card shadow-lg mb-4 rounded-3 border-0">
    <div class="card-header bg-dark text-white py-3 px-4 d-flex align-items-center justify-content-between rounded-top-3">
      <h2 class="h5 mb-0 fw-bold"><i class="bi bi-file-earmark-text-fill me-2"></i>ট্রেড লাইসেন্স দৈনিক ট্রানজেকশন রিপোর্ট</h2>
    </div>
    <div class="card-body p-4">
      <form (ngSubmit)="getTlsDailyReport()" #reportForm="ngForm" class="row g-4 align-items-end">
        <div class="col-12 col-sm-6 col-md-3">
          <label for="municipalityId" class="form-label mb-2 fw-semibold text-dark">পৌরসভা আইডি:</label>
          <input type="number" class="form-control form-control-lg rounded-pill border-dark" id="municipalityId" name="municipalityId" [(ngModel)]="formData.municipalityId" required />
          <div *ngIf="reportForm.controls['municipalityId']?.invalid && reportForm.controls['municipalityId']?.touched" class="text-danger small mt-1">
            পৌরসভা আইডি প্রয়োজন।
          </div>
        </div>

        <div class="col-12 col-sm-6 col-md-3">
          <label for="startDate" class="form-label mb-2 fw-semibold text-dark">শুরুর তারিখ:</label>
          <div class="input-group input-group-lg rounded-pill overflow-hidden">
            <input type="date" class="form-control border-dark border-end-0" id="startDate" name="startDate" [(ngModel)]="formData.startDate" required />
            <span class="input-group-text bg-white border-dark border-start-0 text-primary">
              <i class="bi bi-calendar-date fs-5"></i>
            </span>
          </div>
          <div *ngIf="reportForm.controls['startDate']?.invalid && reportForm.controls['startDate']?.touched" class="text-danger small mt-1">
            শুরুর তারিখ প্রয়োজন।
          </div>
        </div>

        <div class="col-12 col-sm-6 col-md-3">
          <label for="endDate" class="form-label mb-2 fw-semibold text-dark">শেষের তারিখ:</label>
          <div class="input-group input-group-lg rounded-pill overflow-hidden">
            <input type="date" class="form-control border-dark border-end-0" id="endDate" name="endDate" [(ngModel)]="formData.endDate" required />
            <span class="input-group-text bg-white border-dark border-start-0 text-primary">
              <i class="bi bi-calendar-date fs-5"></i>
            </span>
          </div>
          <div class="text-danger small mt-1" *ngIf="reportForm.controls['endDate']?.invalid && reportForm.controls['endDate']?.touched">
            শেষের তারিখ প্রয়োজন।
          </div>
        </div>

        <div class="col-12 col-sm-6 col-md-3 d-flex align-items-end">
          <button type="submit" class="btn btn-dark btn-lg flex-grow-1 shadow-sm rounded-pill" [disabled]="!reportForm.form.valid">
            <i class="bi bi-search me-2"></i> রিপোর্ট দেখুন
          </button>
        </div>
      </form>
    </div>
  </div>

  <div class="card shadow-sm mb-4" *ngIf="showReport">
    <div class="card-body py-3">
      <div class="row g-3 align-items-center">
        <div class="col-12 col-md-6">
          <label for="searchQuery" class="form-label mb-1">মোবাইল নম্বর অথবা লাইসেন্স নম্বর দিয়ে সার্চ করুন:</label>
          <input
            type="text"
            class="form-control form-control-sm"
            id="searchQuery"
            name="searchQuery"
            [(ngModel)]="formData.searchQuery"
            (input)="onSearchChange()"
            placeholder="মোবাইল নম্বর অথবা লাইসেন্স নম্বর লিখুন..."
          />
        </div>
        <div class="col-12 col-md-6">
          <label class="form-label mb-1">অ্যাপ্লিকেশন ফি ফিল্টার:</label>
          <div class="d-flex flex-wrap gap-3">
            <div class="form-check">
              <input
                class="form-check-input"
                type="radio"
                name="applicationFeeFilter"
                id="filterAll"
                value="all"
                [(ngModel)]="formData.applicationFeeFilter"
                (change)="onSearchChange()"
              />
              <label class="form-check-label" for="filterAll">
                সব
              </label>
            </div>
            <div class="form-check">
              <input
                class="form-check-input"
                type="radio"
                name="applicationFeeFilter"
                id="filterWithFee"
                value="with_fee"
                [(ngModel)]="formData.applicationFeeFilter"
                (change)="onSearchChange()"
              />
              <label class="form-check-label" for="filterWithFee">
                অ্যাপ্লিকেশন ফি আছে
              </label>
            </div>
            <div class="form-check">
              <input
                class="form-check-input"
                type="radio"
                name="applicationFeeFilter"
                id="filterWithoutFee"
                value="without_fee"
                [(ngModel)]="formData.applicationFeeFilter"
                (change)="onSearchChange()"
              />
              <label class="form-check-label" for="filterWithoutFee">
                অ্যাপ্লিকেশন ফি নেই
              </label>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="card shadow-sm mb-4" *ngIf="showReport">
    <div class="card-header bg-info text-white py-2 custom-card-header d-flex justify-content-between align-items-center">
      <h2 class="h5 mb-0">রিপোর্টের তথ্য</h2>
      <div class="d-flex">
        <button class="btn btn-light btn-sm me-2" (click)="downloadExcel()" [disabled]="!reportData || reportData.length === 0">
          <i class="bi bi-file-earmark-excel me-1"></i> Excel ডাউনলোড
        </button>
        <button class="btn btn-light btn-sm" (click)="downloadCsv()" [disabled]="!reportData || reportData.length === 0">
          <i class="bi bi-file-earmark-spreadsheet me-1"></i> CSV ডাউনলোড
        </button>
      </div>
    </div>
    <div class="bg-white p-3 border-bottom">
    </div>

    <div class="card-body p-0">
      <div class="table-responsive table-container-scroll">
        <table class="table table-striped table-bordered table-hover mb-0">
          <thead class="sticky-top-table-header">
            <tr>
              <th>ক্রমিক নং</th> <th>লেনদেনের তারিখ</th>
              <th>লেনদেনের পরিমাণ</th>
              <th>এপ্লিকেশন ফী</th>
              <th>মোবাইলনম্বর</th>
              <th>গ্রাহকেরনাম</th>
              <th>গ্রাহকেরপিতারনাম</th>
              <th>যে নামে লাইসেন্স,</th>
              <th>লাইসেন্স নম্বর</th>
              <th>সিরিয়াল নম্বর</th>
              <th>ক্যাটেগরির নাম</th>
              <th>সাইনবোর্ড টাইপ</th>
              <th>সাইনবোর্ডের দৈর্ঘ্য</th>
              <th>সাইনবোর্ডের প্রস্থ</th>
              <th>প্রতি স্কয়ার ফিট সাইন বোর্ডের মূল্য</th>
              <th>সাইনবোর্ড ফি</th>
              <th>লাইসেন্স ফি</th>
              <th>সোর্স ট্যাক্স</th>
              <th>ভ্যাট</th>
              <th>ইনকাম ট্যাক্স</th>
              <th>বকেয়া</th>
              <th>বকেয়ার উপর ভ্যাট</th>
              <th>অন্যান্য</th>
            </tr>
          </thead>
          <tbody>
            <ng-container *ngIf="reportData && reportData.length > 0; else noData">
              <tr *ngFor="let item of reportData; let i = index"> <td>{{ i + 1 }}</td> <td>{{ item.transactiondate }}</td>
                <td>{{ item.transactionamount }}</td>
                <td>{{ item.applicationFee }}</td>
                <td>{{ item.officephone }}</td>
                <td>{{ item.customername }}</td>
                <td>{{ item.fathername }}</td>
                <td>{{ item.title }}</td>
                <td>{{ item.licenseno }}</td>
                <td>{{ item.serialno }}</td>
                <td>{{ item.categorynameb }}</td>
                <td>{{ item.signboardtype }}</td>
                <td>{{ item.height }}</td>
                <td>{{ item.width }}</td>
                <td>{{ item.signboardpersft }}</td>
                <td>{{ item.signboardfee }}</td>
                <td>{{ item.licensefee }}</td>
                <td>{{ item.sourcetax }}</td>
                <td>{{ item.vatfee }}</td>
                <td>{{ item.incometax }}</td>
                <td>{{ item.arrearfee }}</td>
                <td>{{ item.arrearvat }}</td>
                <td>{{ item.otherfee }}</td>
              </tr>
            </ng-container>
            <ng-template #noData>
              <tr>
                <td colspan="23" class="text-center p-4 text-danger"> কোনো ডেটা পাওয়া যায়নি। ডেটা দেখতে উপরের ফর্ম পূরণ করে "রিপোর্ট দেখুন" বাটনে ক্লিক করুন।
                </td>
              </tr>
            </ng-template>
          </tbody>
          <tfoot *ngIf="reportData && reportData.length > 0">
            <tr>
              <td></td> <td class="fw-bold ps-3">মোট:</td> <td class="fw-bolder fs-5 pe-3">{{getTotalPaidMoney() }}</td>
              <td class="fw-bolder fs-5 pe-3">{{getTotalApplicationFee() }}</td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td class="fw-bolder fs-5 pe-3">{{getTotlSigenboardFeeFee() }}</td>
              <td class="fw-bolder fs-5 pe-3">{{getTotlLicenseFeeFee() }}</td>
              <td class="fw-bolder fs-5 pe-3">{{getTotlSourceTaxFee() }}</td>
              <td class="fw-bolder fs-5 pe-3">{{ getTotlVatFee() }}</td>
              <td class="fw-bolder fs-5 pe-3">{{getIncomeTaxFee() }}</td>
              <td class="fw-bolder fs-5 pe-3">{{ getArrearFee() }}</td>
              <td class="fw-bolder fs-5 pe-3">{{ getArrearvatFee() }}</td>
              <td class="fw-bolder fs-5 pe-3">{{ getOtherFee() }}</td>
            </tr>
          </tfoot>
        </table>
      </div>
    </div>
  </div>
</div>